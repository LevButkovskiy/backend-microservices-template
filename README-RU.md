# backend-microservices-template

## Backend Microservices Template Nest.Js Typescript

## Архитектура

Шаблон использует монорепозиторий с двумя приложениями NestJS:

- **gateway** – HTTP шлюз, порт берётся из переменной `GATEWAY_PORT` в `.env`.
- **users** – внутренний TCP микросервис на порту `USERS_PORT`.
- **shared** – общая библиотека с типами. Сервисам достаточно указать `@backend/shared` в зависимостях, и библиотека будет использоваться как сторонний пакет.

## Добавление сервиса

Для создания нового сервиса по примеру `users` выполните команду:

```bash
npm run add:service -- <имя-сервиса>
```

Скрипт сгенерирует проект NestJS в каталоге `packages/<имя-сервиса>`,
добавит зависимость `@backend/shared` и автоматически подключит сервис
к рабочей области.

## Запуск сервисов

Для установки зависимостей во всех сервисах выполните:

```bash
npm run install:services
```

Для запуска всех сервисов в режиме разработки выполните:

```bash
npm run start:services
```

## Docker

Для каждого сервиса есть `Dockerfile`. Файл `docker-compose.yml` подтягивает
готовые образы из реестра. Скопируйте `.env.example` в `.env` и запустите:

```bash
docker compose up
```

## CI/CD

После выполнения workflow `Release` или при ручном запуске workflow `Deploy`
собирает Docker-образы, отправляет их во внешний реестр и разворачивает
их на сервере по SSH. Перед запуском `docker compose` на сервере выполняется
вход в реестр.
